<app-back-button />
<h1>Version 3: Child Forms and Custom UI Controls</h1>

<p>
  <mark>Note:</mark> User "johndoe" already exists. Use this user to simulate async validation
  error.
</p>

<form (submit)="submitForm($event)" novalidate>
  <label>
    Username <app-field-info [fieldRef]="registrationForm.username" />
    <input
      type="text"
      [field]="registrationForm.username"
      [ariaInvalid]="ariaInvalidState(registrationForm.username)"
    />
    <app-form-error [fieldRef]="registrationForm.username" />
  </label>

  <!-- A whole child form with own model -->
  <app-identity-form [identity]="registrationForm.identity" />

  <!-- native HTML inputs bound with the [field] directive -->
  <div>
    <label>
      Age <app-field-info [fieldRef]="registrationForm.age" />
      <input
        type="number"
        [field]="registrationForm.age"
        [ariaInvalid]="ariaInvalidState(registrationForm.age)"
      />
      <app-form-error [fieldRef]="registrationForm.age" />
    </label>
  </div>

  <div>
    <label>
      Password <app-field-info [fieldRef]="registrationForm.password.pw1" />
      <input
        type="password"
        autocomplete
        [field]="registrationForm.password.pw1"
        [ariaInvalid]="ariaInvalidState(registrationForm.password.pw1)"
      />
      <app-form-error [fieldRef]="registrationForm.password.pw1" />
    </label>
    <label>
      Password Confirmation <app-field-info [fieldRef]="registrationForm.password.pw2" />
      <input
        type="password"
        autocomplete
        [field]="registrationForm.password.pw2"
        [ariaInvalid]="ariaInvalidState(registrationForm.password.pw2)"
      />
      <app-form-error [fieldRef]="registrationForm.password.pw2" />
    </label>
    <app-form-error [fieldRef]="registrationForm.password" />
  </div>
  <fieldset>
    <legend>
      E-Mail Addresses
      <button type="button" (click)="addEmail()">+</button>
      <app-field-info [fieldRef]="registrationForm.email" />
    </legend>
    <div>
      @for (emailField of registrationForm.email; track $index) {
      <div>
        <div role="group">
          <input
            type="email"
            [field]="emailField"
            [ariaLabel]="'E-Mail ' + $index"
            [ariaInvalid]="ariaInvalidState(emailField)"
          />
          <button type="button" (click)="removeEmail($index)">-</button>
        </div>
        <app-form-error [fieldRef]="emailField" />
      </div>
      }
    </div>
    <app-form-error [fieldRef]="registrationForm.email" />
  </fieldset>
  <label>
    Subscribe to Newsletter? <app-field-info [fieldRef]="registrationForm.newsletter" />
    <input type="checkbox" [field]="registrationForm.newsletter" />
  </label>
  <app-multiselect
    [field]="registrationForm.newsletterTopics"
    [selectOptions]="['Angular', 'React', 'Vue', 'Svelte']"
    label="Topics (multiple possible):"
  />
  <app-form-error [fieldRef]="registrationForm.newsletterTopics" />
  <label>
    I agree to the terms and conditions
    <app-field-info [fieldRef]="registrationForm.agreeToTermsAndConditions" />
    <input
      type="checkbox"
      [ariaInvalid]="ariaInvalidState(registrationForm.agreeToTermsAndConditions)"
      [field]="registrationForm.agreeToTermsAndConditions"
    />
  </label>
  <app-form-error [fieldRef]="registrationForm.agreeToTermsAndConditions" />
  <hr />
  <app-form-error [fieldRef]="registrationForm" />
  <div role="group">
    <button
      type="submit"
      [disabled]="registrationForm().submitting()"
      [ariaBusy]="registrationForm().submitting()"
    >
      @if (registrationForm().submitting()) { Registering ... } @else { Register }
    </button>
    <button type="reset" (click)="resetForm()">Reset</button>
  </div>
</form>

<app-debug-output [form]="registrationForm" />
